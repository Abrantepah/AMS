import{n as x}from"./micromark-util-normalize-identifier-dfdf0387.js";import{d as C}from"./micromark-util-decode-string-02bf9559.js";function k(e){return e.label||!e.identifier?e.label||"":C(e.identifier)}function D(e,n,t){const r=n.indexStack,o=e.children||[],i=n.createTracker(t),f=[];let l=-1;for(r.push(-1);++l<o.length;){const c=o[l];r[r.length-1]=l,f.push(i.move(n.handle(c,e,n,{before:`
`,after:`
`,...i.current()}))),c.type!=="list"&&(n.bulletLastUsed=void 0),l<o.length-1&&f.push(i.move(v(c,o[l+1],e,n)))}return r.pop(),f.join("")}function v(e,n,t,r){let o=r.join.length;for(;o--;){const i=r.join[o](e,n,t,r);if(i===!0||i===1)break;if(typeof i=="number")return`
`.repeat(1+i);if(i===!1)return`

<!---->

`}return`

`}const L=/\r?\n|\r/g;function j(e,n){const t=[];let r=0,o=0,i;for(;i=L.exec(e);)f(e.slice(r,i.index)),t.push(i[0]),r=i.index+i[0].length,o++;return f(e.slice(r)),t.join("");function f(l){t.push(n(l,o,!l))}}function y(e){if(!e._compiled){const n=(e.atBreak?"[\\r\\n][\\t ]*":"")+(e.before?"(?:"+e.before+")":"");e._compiled=new RegExp((n?"("+n+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(e.character)?"\\":"")+e.character+(e.after?"(?:"+e.after+")":""),"g")}return e._compiled}function R(e,n){return b(e,n.inConstruct,!0)&&!b(e,n.notInConstruct,!1)}function b(e,n,t){if(typeof n=="string"&&(n=[n]),!n||n.length===0)return t;let r=-1;for(;++r<n.length;)if(e.includes(n[r]))return!0;return!1}function w(e,n,t){const r=(t.before||"")+(n||"")+(t.after||""),o=[],i=[],f={};let l=-1;for(;++l<e.unsafe.length;){const s=e.unsafe[l];if(!R(e.stack,s))continue;const h=y(s);let g;for(;g=h.exec(r);){const d="before"in s||!!s.atBreak,m="after"in s,a=g.index+(d?g[1].length:0);o.includes(a)?(f[a].before&&!d&&(f[a].before=!1),f[a].after&&!m&&(f[a].after=!1)):(o.push(a),f[a]={before:d,after:m})}}o.sort(_);let c=t.before?t.before.length:0;const u=r.length-(t.after?t.after.length:0);for(l=-1;++l<o.length;){const s=o[l];s<c||s>=u||s+1<u&&o[l+1]===s+1&&f[s].after&&!f[s+1].before&&!f[s+1].after||o[l-1]===s-1&&f[s].before&&!f[s-1].before&&!f[s-1].after||(c!==s&&i.push(p(r.slice(c,s),"\\")),c=s,/[!-/:-@[-`{-~]/.test(r.charAt(s))&&(!t.encode||!t.encode.includes(r.charAt(s)))?i.push("\\"):(i.push("&#x"+r.charCodeAt(s).toString(16).toUpperCase()+";"),c++))}return i.push(p(r.slice(c,u),t.after)),i.join("")}function _(e,n){return e-n}function p(e,n){const t=/\\(?=[!-/:-@[-`{-~])/g,r=[],o=[],i=e+n;let f=-1,l=0,c;for(;c=t.exec(i);)r.push(c.index);for(;++f<r.length;)l!==r[f]&&o.push(e.slice(l,r[f])),o.push("\\"),l=r[f];return o.push(e.slice(l)),o.join("")}function F(e){const n=e||{},t=n.now||{};let r=n.lineShift||0,o=t.line||1,i=t.column||1;return{move:c,current:f,shift:l};function f(){return{now:{line:o,column:i},lineShift:r}}function l(u){r+=u}function c(u){const s=u||"",h=s.split(/\r?\n|\r/g),g=h[h.length-1];return o+=h.length-1,i=h.length===1?i+g.length:1+g.length+r,s}}S.peek=P;function J(){return{enter:{gfmFootnoteDefinition:B,gfmFootnoteDefinitionLabelString:I,gfmFootnoteCall:M,gfmFootnoteCallString:T},exit:{gfmFootnoteDefinition:A,gfmFootnoteDefinitionLabelString:z,gfmFootnoteCall:E,gfmFootnoteCallString:U}}}function K(){return{unsafe:[{character:"[",inConstruct:["phrasing","label","reference"]}],handlers:{footnoteDefinition:$,footnoteReference:S}}}function B(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function I(){this.buffer()}function z(e){const n=this.resume(),t=this.stack[this.stack.length-1];t.label=n,t.identifier=x(this.sliceSerialize(e)).toLowerCase()}function A(e){this.exit(e)}function M(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function T(){this.buffer()}function U(e){const n=this.resume(),t=this.stack[this.stack.length-1];t.label=n,t.identifier=x(this.sliceSerialize(e)).toLowerCase()}function E(e){this.exit(e)}function S(e,n,t,r){const o=F(r);let i=o.move("[^");const f=t.enter("footnoteReference"),l=t.enter("reference");return i+=o.move(w(t,k(e),{...o.current(),before:i,after:"]"})),l(),f(),i+=o.move("]"),i}function P(){return"["}function $(e,n,t,r){const o=F(r);let i=o.move("[^");const f=t.enter("footnoteDefinition"),l=t.enter("label");return i+=o.move(w(t,k(e),{...o.current(),before:i,after:"]"})),l(),i+=o.move("]:"+(e.children&&e.children.length>0?" ":"")),o.shift(4),i+=o.move(j(D(e,t,o.current()),q)),f(),i}function q(e,n,t){return n===0?e:(t?"":"    ")+e}export{J as a,K as g};
